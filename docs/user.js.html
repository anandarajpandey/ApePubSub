<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>ApePubSub Source: js/src/user.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">ApePubSub</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu inline">
						
						<li>
							<a href="Ape.html">Ape</a>
						</li>
						
						<li>
							<a href="Ape.channel.html">channel</a>
						</li>
						
						<li>
							<a href="Ape.pipe.html">pipe</a>
						</li>
						
						<li>
							<a href="Ape.subuser.html">subuser</a>
						</li>
						
						<li>
							<a href="Ape.user.html">user</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu inline">
						
						<li>
							<a href="APS.html">APS</a>
						</li>
						
						<li>
							<a href="APS.Channel.html">Channel</a>
						</li>
						
						<li>
							<a href="APS.CUser.html">CUser</a>
						</li>
						
						<li>
							<a href="APS.Session.html">Session</a>
						</li>
						
						<li>
							<a href="APS.User.html">User</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu inline">
						
						<li>
							<a href="global.html#randomString">randomString</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: js/src/user.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">/**
 * The user object constructor
 * @param {object} pipe - The pip object as sent by the server
 * @param {APS} client - Instance of the client for internal reference
 * @constructor
 */
APS.User = function(pipe, client){
	Object.defineProperties(this, {
	
		/**
		 * Update function to update properties object
		 * This function is used internally to update objects
		 * when the autoUpdate option is enabled. The function
		 * checks for a revision number in the object. Properties
		 * are only updated if they are different. This method triggers
		 * properties specific events which can be ise observe/watch
		 * property changes 
		 *
		 * @memberOf APS.User.prototype
		 * @method _update
		 * @private
		 *
		 * @param {object} updates - Value key paired of values to update the object
		 */
		_update: {
			value: function(updates){
				if( !! updates)
				{
					updates._rev = parseInt(updates._rev);
					if(updates._rev > this._rev){
						for(var i in updates){
							if(this[i] != updates[i]){
								this[i] = updates[i];
								client.trigger("user"+i+"Update",[updates[i], this]);
								client.trigger("userUpdate",[i, updates[i], this]);
							}
						}
					}
				}
			}
		},
		
		/*
		 * Add the more critical properties which other
		 * methods and the framework itself depend on
		 */
		_rev: {
			value: null,
			configurable: true,
			writable: true
		},
		channels: {
			value: {},
			writable: true
		},
		/**
		 * The user publisher id
		 * Note this property is not enumerable.
		 *
		 * @memberOf APS.User.prototype
		 * @property pubid
		 */
		pubid: {
			value: pipe.pubid
		},
		
		/*
		 * Bind event and logging related functions straight from the client,
		 * effectively saving a whole lot of code :)
		 */
		/**
		 * Publishes/sends anything to the user, a string, object, array or integer
		 *
		 * @param {*} data - Data to send to the channel
		 * @param {bool} sync - Whether to to synchronize the event across the user session
		 * @param {function} callback - Function called after the event is sent
		 *
		 * @memberOf APS.User.prototype
		 * @method pub
		 */
		pub: {
			value: client.pub.bind(client, pipe.pubid)
		},
		/**
		 * Alias for {@link APS.User#pub}
		 *
		 * @memberOf APS.User.prototype
		 * @method publish
		 * @see APS.User#pub
		 */
		publish: {
			value: client.pub.bind(client, pipe.pubid)
		},
		/**
		 * Sends a custom event to the user
		 *
		 * @memberOf APS.User.prototype
		 * @method send
		 *
		 * @param {string} $event -  The name of the event to send
		 * @param {*} data - The data to send with the event
		 * @param {bool} sync - Weather to sync event across the user's session or not
		 * @param {function} callback - Function to call after the event has been sent
		 *
		 * @return {APS} client or parent object reference
		 */
		send: {
			value: client.send.bind(client, pipe.pubid)
		}
	});
	
	/*
	 * Add all public properties to the root of the object
	 * for easy access
	 */
	for(var i in pipe.properties){
		this[i] = pipe.properties[i]
	}
	
}

/**
 * The special current user object constructor
 * @param {object} pipe - The pip object as sent by the server
 * @param {APS} client - Instance of the client for internal reference
 * @constructor
 */
APS.CUser = function(pipe, client){
	Object.defineProperties(this, {

		/**
		 * Update function to update properties object
		 * This function is used internally to update objects
		 * when the autoUpdate option is enabled. The function
		 * checks for a revision number in the object. Properties
		 * are only updated if they are different. This method triggers
		 * properties specific events which can be ise observe/watch
		 * property changes
		 *
		 * @memberOf APS.CUser.prototype
		 * @method _update
		 * @private
		 *
		 * @param {object} updates - Value key paired of values to update the object
		 */
		_update: {
			value: function(updates, force){
				if( !! updates)
				{
					if ( !force )
						updates._rev = parseInt(updates._rev);

					if(updates._rev > this._rev || !!force){
						for(var i in updates){
							if(this[i] != updates[i]){
								this[i] = updates[i];
								this.trigger("user"+i+"Update",[updates[i], this]);
								this.trigger("userUpdate",[i, updates[i], this]);
							}
						}
					}
				}
			}
		},

		/**
		 * Change or update a property in the object and send it to the
		 * server for propagation. In order for this method to work
		 * properly the option {@link APS.option.autoUpdate} should be enabled
		 *
		 * @memberOf APS.CUser.prototype
		 * @method update
		 *
		 * @param {string} name -  The name of the property to update
		 * @param {*} value - The data to set the property to
		 */
		update: {
			value: function(name, value){
				if(typeof name == "object"){
					var data = name;
				}else{
					var data = {};
					data[name] = value;
				}

				this._update(data,true);
				this._client.sendCmd("userPropUpdate", data);
			}
		},
	
	
		/*
		 * Add the more critical properties which other
		 * methods and the framework itself depend on
		 */
		_rev: {
			value: null,
			configurable: true,
			writable: true
		},
		_events: {
			value: {},
			writable: true
		},
		_client: {
			value: client
		},
		/**
		 * The user publisher id.
		 * Note this property is not enumerable.
		 *
		 * @memberOf APS.CUser.prototype
		 * @property pubid
		 */
		pubid: {
			value: pipe.pubid
		},
		/**
		 * The channels the user is a member of, every item
		 * is an instance of {@link APS.Channel}.
		 * Note this property is not enumerable.
		 *
		 * @memberOf APS.CUser.prototype
		 * @property channels
		 */
		channels: {
			value: {},
			writable: true
		},
		
		/*
		 * Bind event and logging related functions straight from the client,
		 * effectively saving a whole lot of code :)
		 */
		/**
		 * Add event handler(s) to the channel
		 *
		 * @memberOf APS.CUser.prototype
		 * @method on
		 *
		 * @param {string} ev - Name of the event handler to add, not case sensitive
		 * @param {function} fn - Function to handle the event
		 *
		 * @return {bool|APS.CUser} False if wrong parameters are passed, otherwise the channel object
		 */
		on: {
			value: client.on.bind(this)
		},
		/**
		 * Trigger event handlers on the user
		 *
		 * @memberOf APS.CUser.prototype
		 * @method trigger
		 * @see APS#trigger
		 */
		trigger: {
			value: client.trigger.bind(this)
		},
		/**
		 * Logs data to the console
		 * It is specified in the out from the call originated from the current user object
		 * @memberOf APS.CUser.prototype
		 * @method log
		 * @see APS#log
		 */
		log: {
			value: client.log.bind(client, "[CurrentUser]")
		}
	});
	
	/*
	 * Add all public properties to the root of the object
	 * for easy access
	 */
	for(var i in pipe.properties){
		this[i] = pipe.properties[i]
	}
}
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					Version 1.6.1
					<br />
					
					
		<span class="copyright">
		Pablo Tejada Copyright Â© 2012-2013.
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a>
		on Sun Oct 20 2013 13:52:10 GMT-0400 (EDT) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
